--DEFINE !pathExportDir
var !user authuser
--!pathExportDir = object file('\\Es001vs0120\GLH\EXCHANGE\USERS\' + !user + '\ISOMETRIC')
!pathExportDir = object file('C:\Users\Public\Documents\AVEVA\USERDATA\ISOMETRIC')
							
if (!pathExportDir.exists() eq FALSE) then
syscom 'mkdir $!pathExportDir'

endif

OPTIONS DEFAULT
AppWareText 'COMMENT1' 'Basic Metric preview Isodraft options file'
AppWareText 'COMMENT2' unset
AppWareText 'COMMENT3' unset
AppWareText 'COMMENT4' unset
AppWareText 'COMMENT5' unset
AppWareText 'COMMENT6' unset
AppWareText 'COMMENT7' unset
AppWareText 'COMMENT8' unset
AppWareText 'COMMENT9' unset
AppWareText 'COMMENT10' unset
AppWareText 'RENAME' 'ON'

--LINE NAME:
!projN = '204927C'
!curpipe = !!CE
!split = !curpipe.namn.split('-')
	!mtoArea=!split[1]
	!nominalDiam=!split[2]
    !fluidCode=!split[3]	
	!unit = !split[4]
	!pipeNumber=!split[5]
	!pipeSpec=!split[6]
	!insulSpec=!split[7].split('_')
!lineId = !split[4] + '-' + !split[3] + '-' + !split[5]
!train = !split[!split.size()].split('_')[2]
!lineLbrSplit = !split[1] + '-' + !split[2] + '"-' + !split[3] + '-' + !split[4] + '-' + !split[5] + '-' + !split[6] + '-' + !insulSpec[1]
!lineLbr = !lineLbrsplit

--FILE NAME
!fileName = !split[1] + '-' + !split[2] + '-' + !split[3] + '-' + !split[4] + '-' + !split[5] + '-' + !split[6] + '-' + !insulSpec[1] + '_' + !train +'_'

--ISO ID
!isoId = !split[1] + '-' + !lineId + '_' + !train

INCH Bore
MM Distance
Precision Bores NOMINAL
CuttingList  OFF
Cutmarks  ON
Charheight 1.8mm
HYPERPLANT  ON
Date UK
Dimdistance String 11mm
Dimdistance Overall 16mm
Dimdistance Supports 6mm
Dimensions ON
Dimensions Composite OFF
Dimension Overall OFF
Dimensions Hangers ALONGSIDE strings
Dimlabels ABOVE
Supports  STRING

--BACKSHEET, MARGENES, AREAS 
Margin  LEFT 5mm
Margin  RIGHT 5mm
Margin  TOP 5mm
Margin  BOTTOM 5mm
Size  A2
FlowArrows ON
FlowArrows Inline Scale 8 AUTOMATIC
Frame off
Reserve 25mm
Reserve MaterialList 75mm

--PENDIENTES
FallingLines  PERCENTAGE 9 AccuracyLevel  1
AngleAccuracy  0
LooseFlangeAllowance 150mm



Isotype  COMBINED

File AND DXF PDF  "$!pathExportDir\$!fileName"  SINGLE
--File AND DXF PDF  "$!pathExportDir\previewIsoStd"  SINGLE
File SET PDF View Comp BW Bindpages
File SET PRINT Nofit Dialog Colourplus Bindpages
File SET IMAGE PNG Colourplus Bindpages
File SET EMF Colourplus Bindpages

--TTFont ON
--TTFont 5


Units  METIMP
Mark Detail  OFF
Mark Revision  OFF
Mark Ignore  ON
PlottingScale  100
PictureScale  100

--SPLIT. CoNtrols the number of drawing sheets used when a pipeline is split over more than one sheet. You can control splitting either by giving a split factor, or by specifying the number of drawings used for the isometric.The default value of the split factor is 100.You can control exactly where pipes are split by using Split ATTAs in the design
Stacking  1  ALONG
Split  150  PERCENT
SpoolNumbers  OFF

--ISO. Defines the view direction to be used for generating the Isometric plot.
ISO  3
Wastage AREA 1 1
Wastage AREA 2 1
Wastage AREA 3 1
Wastage AREA 4 1
Wastage AREA 5 1
Wastage AREA 6 1
Wastage AREA 7 1
Wastage AREA 8 1
Wastage AREA 9 1
Weldnumbers  OFF
Weldid OFF
Weldtype  ON
Underlayplot  "%GLHISO%/UND/GALP-HVO_A2.plt" 1
SymbolFile "%aveva_design_exe%/iso_symbols\mds-skeys" READONLY
MessageFile /%AVEVA_DESIGN_USER%\mess OVERWRITE
TransferFile  OFF
CllengthFile  OFF
CutpipelistFile  OFF
SupportFile  OFF

--TABLA DE MATERIALES
MatlistFile  OFF
MatControl  OFF
MaterialList  ON
MaterialList  DRWG
MaterialList  RIGHT  DESCRIPTION
MaterialList Charheight 2.0mm  Lspacing  150
MaterialList  Code  29 DUMMY SUFFIX  SINGLE
MaterialList PartNumbers GENERATED

--COLUMNAS DE LA TABLA DE MATERIALES. ATTRIBUTOS, NUMERO Y ANCHO.
MaterialList  GRIDLINES OFF
MaterialList TableDefinition Column 1 PARTNUMBER with Width 5
Column 2 BORE with Width 8
Column 3 DESCRIPTION with Width 71
Column 4  OTHER Heading 'IDENT'  :TP-IDENT FROMSPCOM with Width 8
Column 5 QUANTITY in Metres with Width 8

Atext 219 'REINFORCED'
Atext 250 ''
Atext 251 ''
Atext 252 ''
Atext 253 ''
Atext 254 ''
Atext 255 ''
Atext 256 ''
Atext 257 ''
Atext 270 ''
Atext 271 ''
Atext 272 ''
Atext 288 'PIPE'
Atext 290 'INSUL'
Atext 291 'TRACE'
Atext 293 'INTH'
Atext 298 ''
Atext 317 ''
Atext 318 ''
Atext 300 'MATERIAL LIST - FABRICATION'
Atext 301 'ITEM'
Atext 302 ''
Atext 303 'DESCRIPTION'
Atext 304 'N.S.'
Atext 306 'QTY'
Atext 307 ''
Atext 308 ''
Atext 309 ''
Atext 310 'MATERIAL LIST - ERECTION'
Atext 311 ''
Atext 312 ''
Atext 313 ''
Atext 314 ''
Atext 315 'PIPE SUPPORTS'
Atext 317 ''
Atext 318 ''
Atext 333 ''
Atext 336 ''
Atext 388 ''
Atext 400 ''
Atext 401 ''
Atext 402 ''
Atext 403 ''
Atext 404 ''
Atext 405 ''
Atext 406 ''
Atext 407 ''
Atext 410 ''
Atext 411 ''
Atext 470 ''
Atext 475 'ANGLE'
Atext 476 'RADIUS'
Tagging OFF
Instname  NAME with balloon size 8							  
CompipeFile  OFF
Compipe MTO DRWG
Compipe Itemcodes USER
Compipe Descriptions SHORT
Compipe Supports ON
Delimiter  ATsymbol
InsulationControl  ON
TracingControl  ALL
Attaname  OFF
Tolerance  Offset 1mm
Tolerance  Angle  0.06
Specbreak  COMPONENT  SpecChanges ON
--Axes  WORL /*
Axes  /COORDS-PI
ContinuationSymbols NOZZ
Itemcode Valves DEFAULT
Itemcode Instruments DEFAULT
Itemcode Pcoms DEFAULT
Itemcode Traps DEFAULT
Itemcode Vents DEFAULT
Itemcode Filters DEFAULT
Itemcode  TOTAL
Itemcode  from :TP-IDENT
--Itemcode for Supports from SPREF
Bolting  length description ON
Bolting  length itemcode APPEND
Bolting  Units  METIMP
--Coords  ON AT Pipe
Coords  ON AT Nozz
Coords  OFF AT Open
Coords  OFF AT Clos
Coords  OFF AT Vent
Coords  OFF AT Dran
Coords  OFF AT Shee
Coords  ON AT Misc
Elevation    INTERSECTION
Skewbox  TRIANGLE NSTD Standout 4mm Hatch 3mm Partial 20mm Tags OFF
Zerolengthskews Off
Fallskews THREEDBOX  ON

--CHEQUEO DE LONGITUD DE TRAMOS DE TUBERÍA INFERIORES A 100MM
IF (Function   EQ 'ERROR' and :SPOOL-VALIDATION EQ '') THEN
handle (2,201) $* Element :Cpipes /810-M2233-4131SG-25-OF-1_01 does not have attribute FUNC
endhandle
TextPosition 'SHORT SPOOL, CHECK ISOMETRIC' 			X 70mm Y 200mm  CharHeight 20mm
ENDIF
-----------------------------------------------------------------

TextPosition NAME X 0mm Y 0mm CharHeight 0mm
TextPosition '$!lineLbr' X 480mm Y 17mm CharHeight 2.4mm

TextPosition 'LINE LBR:' X 454mm Y 17mm CharHeight 2.4mm

TextPosition 'ISO ID:' X 413mm Y 23mm CharHeight 2.4mm
TextPosition '$!isoId' X 428mm Y 23mm CharHeight 2.4mm

TextPosition 'UNIT:' X 413mm Y 17mm CharHeight 2.4mm
TextPosition '$!unit' X 428mm Y 17mm CharHeight 2.4mm

TextPosition 'PROJECT' X 420mm Y 8mm CharHeight 1.8mm
TextPosition '$!projN' X 418mm Y 11.5mm CharHeight 2.4mm
TextPosition 'DESIGN AREA' X 454mm Y 8mm CharHeight 1.8mm
TextPosition :TP-WP X 454mm Y 11.5mm CharHeight 2.4mm
--TextPosition '$!mtoArea' X 458mm Y 11.5mm CharHeight 2.4mm

TextPosition 'LINE ID' X 500mm Y 8mm CharHeight 1.8mm
TextPosition '$!lineId' X 495mm Y 11.5mm CharHeight 2.4mm

TextPosition 'TRAIN' X 540mm Y 8mm CharHeight 1.8mm
TextPosition '$!train' X 542mm Y 11.5mm CharHeight 2.4mm

TextPosition 'Rev' X 411mm Y 46.5mm CharHeight 2.2mm
TextPosition 'Date' X 424mm Y 46.5mm CharHeight 2.2mm
TextPosition 'Description' X 445mm Y 46.5mm CharHeight 2.2mm
TextPosition 'Prep.' X 533mm Y 46.5mm CharHeight 2.2mm
TextPosition 'Chk.' X 555mm Y 46.5mm CharHeight 2.2mm
TextPosition 'Appr.' X 573mm Y 46.5mm CharHeight 2.2mm

--REVISONES 'los datos llegan de isotracker desde la ventana issuer cuando los isos llegan a la bandeja de ISSUED'
var !RevTexts collect all text for CE
!LastRev = ''
!xY = 52
Do !z From 1 To 6 by 1
	!RevTextInd 	= !RevTexts[!z].dbref().Attribute(':TP-REV-IND')
	handle(2,752)
		!RevTextInd = ''
	endhandle
	If !RevTextInd neq '' then
		!LastRev = !RevTextInd
	EndIf
	
	!RevTextDate 	= !RevTexts[!z].dbref().Attribute(':TP-REV-DATE')
	handle(2,752)
		!RevTextDate =	''
	endhandle
	
	!RevTextDesig 	= !RevTexts[!z].dbref().Attribute(':TP-REV-DESIGNATION')
	handle(2,752)
		!RevTextDesig =	''
	endhandle
	
	!RevTextDraw 	= !RevTexts[!z].dbref().Attribute(':TP-REV-DRAW')
	handle(2,752)
		!RevTextDraw =	''
	endhandle
	
	!RevTextCheck	= !RevTexts[!z].dbref().Attribute(':TP-REV-CHECK')
	handle(2,752)
		!RevTextCheck =	''
	endhandle
	
	!RevTextAppr 	= !RevTexts[!z].dbref().Attribute(':TP-REV-APPR')
	handle(2,752)
		!RevTextAppr =	''
	endhandle
	
	TextPosition '$!RevTextInd'   X 410mm Y $!xY mm Charheight 2.8mm
	TextPosition '$!RevTextDate'  X 420.5mm Y $!xY mm Charheight 1.8mm
	TextPosition '$!RevTextDraw'  X 533mm Y $!xY mm Charheight 2.8mm
	TextPosition '$!RevTextCheck' X 554mm Y $!xY mm Charheight 2.8mm
	TextPosition '$!RevTextAppr'  X 574mm Y $!xY mm Charheight 2.8mm
	TextPosition '$!RevTextDesig' X 440mm Y $!xY mm Charheight 2.8mm 
	!xY = !xY + 6
EndDo

TextPosition '$!LastRev' X 579mm Y 11mm CharHeight 3.0mm


TextPosition 'NOTES:' X 8mm Y 28.5mm CharHeight 1.8mm
TextPosition '1. ALL DIMENSIONS ARE IN MILLIMETERS.' X 8mm Y 26mm CharHeight 1.5mm
TextPosition '2. FOR LINE DETAILED DATA REFER TO PROCESS LINE LIST 204927C-100-NM-0022-0001.' X 8mm Y 23mm CharHeight 1.5mm
TextPosition '3. FOR PIPE SUPPORT DETAILED INFORMATION REFER TO SUPPORT LIST 204927C-100-NM-1350-0001.' X 8mm Y 20mm CharHeight 1.5mm
TextPosition '4. FOR SMALL BORE LINE (<2") PIPE SUPPORT DEFINITION AND LOCATION BY CONSTRUCTION CONTRACTOR.' X 8mm Y 17mm CharHeight 1.5mm
TextPosition '5. SPOOLING AND PREFABRICATION OF LINES PERFORMED BY THE CONSTRUCTION CONTRACTOR SHOULD CONSIDER PIPING ADJUSTMENTS.' X 8mm Y 14mm CharHeight 1.5mm
--If :TP-PWTH eq 'NOTE 5' then
TextPosition '5*. PWHT AS PER REQUIREMENTS ON 204927C-000-JSD-1300-0021 - PIPIPNG CLASS SUMMARY' X 8mm Y 11mm CharHeight 1.5mm
--EndIf
--TextPosition '6. COUPLING WILL BE LOCATED FOR SMALL BORE PIPE BY CONSTRUCTION CONTRACTOR WHEN REQUIRED.' X 8mm Y 8mm CharHeight 1.5mm
TextPosition '6. LOCATION OF COUPLING CONNECTIONS REQUIRED FOR SMALL BORE LINES ARE FOR REFERENCE ONLY. FINAL LOCATION TO BE DECIDED BY CONSTRUCTION CONTRACTOR.' X 8mm Y 8mm CharHeight 1.5mm

TextPosition 'CONFIDENTIAL' X 246mm Y 27mm CharHeight 2.2mm
TextPosition 'NOT TO DISCLOSE WITHOUT AUTHORIZATION' X 232mm Y 23mm CharHeight 1.6mm
TextPosition 'THIS DOCUMENT IS DISCLOSED ONLY TO AUTHORIZED PEOPLE' X 222mm Y 20mm CharHeight 1.6mm
TextPosition 'WHO NEED TO KNOW' X 246mm Y 17mm CharHeight 1.6mm
TextPosition 'THIS DOCUMENT CAN BE DISCLOSED TO A THIRD PARTY' X 226mm Y 14mm CharHeight 1.6mm
TextPosition 'ACCORDING TO A CONFIDENTIALLY AGREEMENT AND WITH' X 225mm Y 11mm CharHeight 1.6mm
TextPosition 'AUTHORIZATION' X 248mm Y 8mm CharHeight 1.6mm

TextPosition 'PID NUMBER:' X 297mm Y 27mm CharHeight 2mm
TextPosition :TP-PID-NUM X 320mm Y 27mm CharHeight 2mm
--TextPosition 'XXXXXXXXXXXXXXXXXXXXX' X 320mm Y 27mm CharHeight 2mm

TextPosition 'PIPING CLASS:' X 297mm Y 21mm CharHeight 2mm
TextPosition PSPEC X 325mm Y 21mm CharHeight 2mm

TextPosition 'PED:' X 297mm Y 15mm CharHeight 2mm
TextPosition :TP-PED-CAT X 308mm Y 15mm CharHeight 2mm
--TextPosition ':TP-PED-CAT' X 308mm Y 15mm CharHeight 2mm

------------------------------------------------------------------
TextPosition 'PRESS TEST:' X 297mm Y 9mm CharHeight 2mm

!testPres	= :TP-PRE-TEST
!testPresConvers = !testPres & |g|
!testPresToBarg = replace(!testPresConvers,'pascalg','Barg')

TextPosition '$!testPresToBarg' X 316mm Y 9mm CharHeight 1.5mm
------------------------------------------------------------------

TextPosition 'PAINT:' X 333mm Y 15mm CharHeight 2mm
TextPosition :TP-PAINT-2 X 345mm Y 15mm CharHeight 2mm
--TextPosition 'PAINT:' X 345mm Y 15mm CharHeight 2mm

TextPosition 'PWHT:' X 333mm Y 9mm CharHeight 2mm
TextPosition :TP-PWTH X 345mm Y 9mm CharHeight 2mm
--TextPosition '710001' X 345mm Y 9mm CharHeight 2mm

--Cambio degC to C-----------------------------------------------
!opTemp	= TEMP
!opConvers = !opTemp & |C|
!opTempTOC = replace(!opConvers,'degCC','C')

!desiTemp	= :TP-TMP-DESI
!desiConvers = !desiTemp & |C|
!desiTempTOC = replace(!desiConvers,'degCC','C')

TextPosition 'TEMP OP/DES:' X 366mm Y 27mm CharHeight 2mm
TextPosition '$!opTempToC' X 387mm Y 27mm CharHeight 2mm
TextPosition '/' X 395mm Y 27mm CharHeight 2mm
TextPosition '$!desiTempToC' X 398mm Y 27mm CharHeight 2mm
-----------------------------------------------------------------

--Cambio pascal to Barg------------------------------------------
var !press :TP-PRE-OPER
!opPres	= |$!press|

--!opPresConvers = !opPres & |g|
!opPresConvers = !opPres & |Barg|
--!opPresToBarg = replace(!opPresConvers,'pascalg','Barg')
!opPresToBarg = !opPresConvers

!desiPres	= PRES
!desiPresConvers = !desiPres & |g|
!desiPresToBarg = replace(!desiPresConvers,'pascalg','Barg')

TextPosition 'PRESS OP/DES:' X 366mm Y 21mm CharHeight 2mm
TextPosition '$!opPresToBarg' X 390mm Y 22.5mm CharHeight 1.5mm
TextPosition '/' X 402mm Y 22.5mm CharHeight 1.5mm
TextPosition '$!desiPresToBarg' X 390mm Y 20mm CharHeight 1.5mm
-----------------------------------------------------------------

TextPosition 'INSUL. THK:' X 366mm Y 15mm CharHeight 2mm
TextPosition :TP-FLU-TEST X 388mm Y 15mm CharHeight 2mm
--TextPosition :TP-INS-THK X 388mm Y 15mm CharHeight 2mm

TextPosition 'INSUL. TYP:' X 366mm Y 9mm CharHeight 2mm
TextPosition '$!insulSpec[1]' X 388mm Y 9mm CharHeight 2mm
----------------------------------TextPosition :700038INS1CODE X 388mm Y 15mm CharHeight 20mm
-- HOJA DE HOJA
TextPosition SHEETN X 565mm Y 11.5mm CharHeight 3mm
TextPosition '/' X 569mm Y 11.5mm CharHeight 3mm
TextPosition SHEETT X 571.5mm Y 11.5mm CharHeight 3mm
TextPosition 'SHEET' X 566.8mm Y 8mm CharHeight 1.8mm

TextPosition 'REV' X 580mm Y 8mm CharHeight 1.8mm

Bendradius DISTANCE
Itemcode  Length SHORT
Tapping Scale  100
Tapping Dimensions ON
Tapping Coordinates OFF
Truncate OFF
Weldangles OFF
EquipmentNumbering NOZZLE
Outcom NAME on FILT with Boxstyle ANGLED
Outcom NAME on FLAN with Boxstyle ANGLED
Outcom NAME on TEE with Boxstyle ANGLED
Outcom NAME on PCOM with Boxstyle ANGLED
Outcom NAME on SHU with Boxstyle ANGLED
Outcom NAME on VALV with Boxstyle ROUND
Outcom :TP-LOCK on VALV
Outcom :TP-LOCK on INST
Outcom NAME on VTWA with Boxstyle ANGLED
--Outcom NAME on SUPP
--Outcom :TP-MDS-FUNC on SUPP
Outcom :TPI-COMENTARIO on SUPP
Outcom :TP-MDS-ITEM on SUPP Boxstyle diam
Outcom :TP-SuppFunction on SUPP Boxstyle 
Tubesplits ON
Repeatability OFF
Mtexts  ON
Mtexts  XTEXT
Dtexts  ON
Dtexts  RTEXT
Leglength 9mm
Overallskews ON
Refdimensions OFF
BoltFile  OFF
WeldTableFile  OFF
BendTableFile  OFF
ContNotes BOTH Descriptions  ON
ContSheets  ON
ContWelds  OFF
ContJoints  OFF
JointNumbers  OFF
PBendNumbers OFF
Logical TRUE 'TRUE' FALSE 'FALSE'
ShortCode  OFF
--PipenameDelimiter Prefix  OFF
--PipenameDelimiter Suffix  OFF
LineThickness 6
MessageAccuracy RADIAL 1
MessageAccuracy ITERATIONS 1
PartNoEnclosure STRGTB
--Coformat USER
--Counits MM
--Codecp 0
--Coimpp SIXTEENTHS
Cutback none
Attexts none
Change Highlighting  OFF
Change Highlighting Colour 2
Change Highlighting  Rule  Unset
$.